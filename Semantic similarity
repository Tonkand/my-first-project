import spacy
import pandas as pd

# 加载大型模型以支持相似度
nlp = spacy.load("en_core_web_lg")

# 你的设备清单（词组）
equipment_list = ["fluid bed dryer", "centrifuge", "microscope", "syringe", "high-speed mixer"]
equipment_docs = [nlp(eq) for eq in equipment_list]

# 模拟一批文章（可替换成从文件或DataFrame读取）
documents = [
    "The fluidized drying system is efficient for particle processing.",
    "Our lab uses a high-resolution microscope and a manual syringe.",
    "They purchased a centrifugal machine instead of a centrifuge.",
    "This device is unrelated to any listed equipment.",
]

# 设置阈值
SIMILARITY_THRESHOLD = 0.75

# 保存匹配结果
results = []

for idx, text in enumerate(documents):
    doc = nlp(text)
    matched_items = []
    
    # 每句话对每个设备比对一次
    for eq_doc, eq_name in zip(equipment_docs, equipment_list):
        sim = doc.similarity(eq_doc)
        if sim >= SIMILARITY_THRESHOLD:
            matched_items.append((eq_name, round(sim, 3)))
    
    # 记录结果
    results.append({
        "doc_id": idx,
        "text": text,
        "matched_equipment": [e[0] for e in matched_items],
        "similarities": [e[1] for e in matched_items]
    })

# 展示为DataFrame
df = pd.DataFrame(results)
from ace_tools import display_dataframe_to_user
display_dataframe_to_user(name="Equipment Matching Results", dataframe=df)
